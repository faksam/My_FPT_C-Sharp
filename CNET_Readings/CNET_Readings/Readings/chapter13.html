<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252" />
<title>FPT University - C# & .NET technology</title>
<link rel="stylesheet" href="cf112.css" type="text/css" charset="utf-8" />
</head>
<body>
    <div align="center">
      <center>
    <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-width: 0; bordercolor: #111111" width="1024" id="AutoNumber6">
      <tr>
        <td width="1024" style="border-style: none; border-width: medium; height:168px" height="2" bgcolor="#339966" bordercolor="#333333" background="images/background.jpg"><br /><br />
        <p style="margin-left: 4; margin-top: 0; margin-bottom: 0; text-align:center" ><br/>
        <b><font size="5" color="#FFFFFF" face="Arial Black">Software Development</font></b></p>
        <p style="margin-left: 4; margin-top: 0; margin-bottom: 0"><i>
        <font face="Arial Black" color="#FFCC00">&nbsp;</font></i><br/>
        <br/></p>&nbsp;</td>
      </tr>
      <tr>
        <td width="1024" style="border-style: none; border-width: medium; bordercolor:#333333" bgcolor="#FFFFFF" valign="top">
        <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-left-width: 0; border-right-width: 0; border-bottom-width:0" bordercolor="#006666" width="100%" id="AutoNumber7" height="8">
          <tr>
            <td width="12%" style="border-left: 1px solid #006666; border-right-style: solid; border-right-width: 1; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="index.html">Home</a></td>
            <td width="18%" style="border-left-style: solid; border-left-width: 1; border-right-style: solid; border-right-width: 1; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="outline.html">Outline</a></td>
            <td width="26%" style="border-left-style: solid; border-left-width: 1; border-right-style: solid; border-right-width: 1; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="timeline.html">Timeline</a></td>
            <td width="24%" style="border-left-style: solid; border-left-width: 1; border-right-style: solid; border-right-width: 1; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="readings.html">Readings</a></td>
            <td width="20%" style="border-left-style: solid; border-left-width: 1; border-right: 1px solid #006666; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="instructors.html">Instructors</a></td>
          </tr>
          <tr>
            <td width="100%" style="border-left-style: none; border-left-width: medium; border-right-style: none; border-right-width: medium; border-top-style: solid; border-top-width: 1; border-bottom-style: none; border-bottom-width: medium" align="center" colspan="5">
            <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-width: 0" bordercolor="#111111" width="100%" id="AutoNumber8">
              <tr>
                <td width="100%" style="border-style: none; border-width: medium">
                <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-left-width: 2; border-right-width: 2; border-top-width: 2; border-bottom-width: 0" bordercolor="#006666" id="AutoNumber9" height="1">
                  <tr>
                    <td width="100%" style="border-style: none; border-width: medium" height="1" colspan="2" bgcolor="#004646">
                    <p style="margin-top: -6; margin-bottom: -6"/></td>
                  </tr>
                  <tr>
                    <td style="border-left-style: none; border-left-width: medium; border-right-style: none; border-right-width: medium; border-top-style: none; border-top-width: medium; border-bottom: 2px none #006666" height="1" bgcolor="#006666" valign="top">
                    <div align="center" style="width: 169">
                      <center>
                      <p style="margin-top: -4; margin-bottom: -4">&nbsp;</p>
                      <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" width="91%" id="AutoNumber10" bgcolor="#FFFFFF" height="1" bordercolor="#003399">
                        <tr>
            <td width="100%" bgcolor="#CAD6EE" style="border-left-color: #003399; border-left-width: 2; border-right-color: #003399; border-right-width: 2; border-top-color:#003399; border-bottom-color:#003399" height="20">
            <p style="margin: 2 3"><b>
            <font face="Verdana" size="2" color="#003399">Readings</font></b></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-bottom-style: none; border-bottom-width: medium; border-top-style:solid; border-top-width:1" height="25">
            <p style="margin: 2 3; "><a class="leftmenu" href="Chapter01.html">Chapter 1</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter02.html">Chapter 2</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter03.html">Chapter 3</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter04.html">Chapter 4</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter05.html">Chapter 5</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter06.html">Chapter 6</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter07.html">Chapter 7</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter08.html">Chapter 8</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter10.html">Chapter 10</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter11.html">Chapter 11</a></p></td>
                        </tr>                        
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter13.html">Chapter 13</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter14.html">Chapter 14</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter16.html">Chapter 16</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter17.html">Chapter 17</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter19.html">Chapter 19</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter20.html">Chapter 20</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter21.html">Chapter 21</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter22.html">Chapter 22</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter23.html">Chapter 23</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter24.html">Chapter 24</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter25.html">Chapter 25</a></p></td>
                        </tr>
                      </table>
                      </center>
                    </div>
                    </td>                    
                    <td width="855" style="border-left-style: none; border-left-width: medium; border-right-style: solid; border-right-width: 1; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium" height="1" valign="top">
                    <div style="margin-left:10px;margin-top:10px;margin-bottom:10px;margin-right:10px">
                    <h1>Chapter 13 - Processes, AppDomains, Contexts and CLR Hosts</h1>
                    <span id="top" class="style1">Content</span>
                    <ul>
                    <li><a href="#pro" class="leftmenu">Introduction to Win32 Processes</a></li>                    
                    <li><a href="#nam" class="leftmenu">Introduction to System.Diagnostics namespace</a></li>
                    <li><a href="#app" class="leftmenu">Understanding .NET Application Domains</a></li>
                    <li><a href="#obj" class="leftmenu">Understanding Object Context Boundaries</a></li>
                    <li><a href="#clr" class="leftmenu">Hosting the Common Language Runtime</a></li>
                    <li><a href="#sum" class="leftmenu">Summary</a></li>
                    </ul>
                    <p class="normal">
                    In this chapter, you’ll drill deeper into the details of how an assembly is hosted by the CLR and come to understand the relationship between processes, application domains, and object contexts.
                    </p>
                    <span id="pro" class="style1">Introduction to Win32 Processes</span>
                    <p class="normal">
                    The concept of a "process" has existed within Windows-based operating systems well before the release of the .NET platform. 
                    Simply put, <i>process</i> is the term used to describe the set of resources (such as external code libraries and the primary thread) and the necessary memory allocations used by a running application. 
                    For each *.exe loaded into memory, the OS creates a separate and isolated process for use during its lifetime. 
                    Using this approach to application isolation, the result is a much more robust and stable runtime environment, given that the failure of one process does not affect the functioning of another.<br />
                    Now, every Win32 process is assigned a unique process identifier (PID) and may be independently loaded and unloaded by the OS as necessary. 
                    As you may be aware, the Processes tab of the Windows Task Manager utility allows you to view various statistics regarding the processes running on a given machine, including its PID and image name.
                    </p>
                    <div style="text-align:center;"><img alt="" src="images/1301.jpg" /></div>
                    <p class="normal">
                    Every Win32 process has exactly one main "thread" that functions as the entry point for the application. 
                    First of all, a <i>thread</i> is a path of execution within a process. Formally speaking, the first thread created by a process's entry point is termed the <i>primary thread</i>.<br />
                    Processes that contain a single primary thread of execution are intrinsically <i>thread-safe</i>, given the fact that there is only one thread that can access the data in the application at a given time. 
                    However, a single-threaded process (especially one that is GUI-based) will often appear a bit unresponsive to the user if this single thread is performing a complex operation (such as printing out a lengthy text file, 
                    performing an exotic calculation, or attempting to connect to a remote server located thousands of miles away).<br />
                    Given this potential drawback of single-threaded applications, the Win32 API makes it is possible for the primary thread to spawn additional secondary threads 
                    (also termed <i>worker threads</i>) using a handful of Win32 API functions such as CreateThread(). Each thread (primary or secondary) becomes a unique path of execution in the process and has concurrent access to all shared points of data.                    
                    </p>                    
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="nam" class="style1">Introduction to System.Diagnostics namespace</span>
                    <p class="normal">
                    The System.Diagnostics namespace defines a number of types that allow you to programmatically interact with processes and various diagnostic-related types such as the system event log and performance counters. 
                    In this chapter, we are only concerned with the process-centric types defined in the below table.
                    </p>
                    <table border="1" cellpadding="5" cellspacing="0">
                        <tr>
                            <td class="header">Process-Centric Types of the System.Diagnostics Namespace</td>
                            <td class="header">Meaning in Life</td>
                        </tr>
                        <tr>
                            <td valign="top">Process</td>
                            <td>The Process class provides access to local and remote processes and also allows you to programmatically start and stop processes.</td>
                        </tr>
                        <tr>
                            <td valign="top">ProcessModule</td>
                            <td>
                            This type represents a module (*.dll or *.exe) that is loaded into a particular process. 
                            Understand that the ProcessModule type can represent any module COM-based, .NET-based, or traditional C-based binaries.
                            </td>
                        </tr>
                        <tr>
                            <td valign="top">ProcessModuleCollection</td>
                            <td>Provides a strongly typed collection of ProcessModule objects.</td>
                        </tr>
                        <tr>
                            <td valign="top">ProcessStartInfo</td>
                            <td>Specifies a set of values used when starting a process via the Process.Start()method.</td>
                        </tr>
                        <tr>
                            <td valign="top">ProcessThread</td>
                            <td>Represents a thread within a given process. Be aware that ProcessThread is a type used to diagnose a process's thread set 
                            and is not used to spawn new threads of execution within a process</td>
                        </tr>
                        <tr>
                            <td valign="top">ProcessThreadCollection</td>
                            <td>Provides a strongly typed collection of ProcessThread objects.</td>
                        </tr>
                    </table><br />
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="app" class="style1">Understanding .NET Application Domains</span>
                    <p class="normal">
                    Under the .NET platform, assemblies are not hosted directly within a process (as is the case in traditional Win32 applications). Rather, 
                    a .NET executable is hosted by a logical partition within a process termed an <i>application domain</i> (aka AppDomain). As you will see, a single process may contain multiple application domains, 
                    each of which is hosting a .NET executable. This additional subdivision of a traditional Win32 process offers several benefits, some of which are as follows:
                    </p>
                    <ul>
                    <li>AppDomains are a key aspect of the OS-neutral nature of the .NET platform, given that this logical division abstracts away the differences in how an underlying OS represents a loaded executable.</li>
                    <li>AppDomains are far less expensive in terms of processing power and memory than a fullblown process. Thus, the CLR is able to load and unload application domains much quicker than a formal process</li>
                    <li>AppDomains provide a deeper level of isolation for hosting a loaded application. If one AppDomain within a process fails, the remaining AppDomains remain functional</li>
                    </ul>
                    <p class="normal">
                    While a single process may host multiple AppDomains, this is not always the case. At the very least, an OS process will host what is termed the <i>default application domain</i>. 
                    This specific application domain is automatically created by the CLR at the time the process launches.<br />
                    After this point, the CLR creates additional application domains on an as-needed basis. If the need should arise (which it most likely will not for the majority of your .NET endeavors), 
                    you are also able to programmatically create application domains at runtime within a given process using static methods of the System.AppDomain class.
                    </p>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="obj" class="style1">Understanding Object Context Boundaries</span>
                    <p class="normal">
                    AppDomains are logical partitions within a process used to host .NET assemblies. On a related note, a given application domain may be further subdivided into numerous context boundaries. 
                    In a nutshell, a .NET context provides a way for a single AppDomain to establish a "specific home" for a given object.<br />
                    Using context, the CLR is able to ensure that objects that have special runtime requirements are handled in an appropriate and consistent manner by intercepting method invocations into and out of a given context. 
                    This layer of interception allows the CLR to adjust the current method invocation to conformto the contextual settings of a given object. For example, if you define a C# class type that requires automatic thread safety 
                    (using the [Synchronization] attribute), the CLR will create a "synchronized context" during allocation.<br />
                    Just as a process defines a default AppDomain, every application domain has a default context. This default context (sometimes referred to as <i>context 0</i>, given that it is always the first context created within an application domain) 
                    is used to group together .NET objects that have no specific or unique contextual needs. As you may expect, a vast majority of .NET objects are loaded into context 0. If the CLR determines a newly created object has special needs, 
                    a new context boundary is created within the hosting application domain. The below figure illustrates the process/AppDomain/context relationship.
                    </p>
                    <div style="text-align:center;"><img alt="" src="images/1302.jpg" /></div><br />
                    <span class="style2">Context-Agile and Context-Bound types</span><br />
                    <p class="normal">
                    .NET types that do not demand any special contextual treatment are termed <i>context-agile</i> objects. These objects can be accessed from anywhere within the hosting AppDomain without interfering with the object's runtime requirements. 
                    Building context-agile objects is a no-brainer, given that you simply do nothing (specifically, you do not adorn the type with any contextual attributes and do not derive from the System.ContextBoundObject base class):                    
                    </p>                    
                    <p class="sample">
                    <span class="comment">//A context-agile object is loaded into context 0.</span><br />
                    <span class="keyword">public class</span> SportsCar {}
                    </p>
                    <p class="normal">
                    On the other hand, objects that do demand contextual allocation are termed <i>context-bound</i> objects, and they must derive from the System.ContextBoundObject base class. 
                    This base class solidifies the fact that the object in question can function appropriately only within the context in which it was created. Given the role of .NET context, 
                    it should stand to reason that if a context-bound object were to somehow end up in an incompatible context, bad things would be guaranteed to occur at the most inopportune times.
                    </p>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="clr" class="style1">Hosting the Common Language Runtime</span>
                    <p class="normal">
                    Given that the Windows OS does not natively understand the format of a .NET assembly, it should be clear that various steps occur in the background when an executable assembly is activated. 
                    Under the Windows XP OS, the basic steps are as follows:
                    </p>
                    <ol>
                    <li>The Windows OS loads the executable binary file into memory.</li>
                    <li>The Windows OS reads the embedded WinNT header to determine if the binary file is a .NET assembly (via the IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR flag).</li>
                    <li>If the image is a .NET assembly, mscoree.dll is loaded.</li>
                    <li>mscoree.dll then loads <i>one of two</i> implementations of the CLR (mscorwks.dll or mscorsvr.dll).</li>
                    <li>At this point, the CLR takes over the show, performing all .NET-centric details (finding external assemblies, performing security checks, processing CIL code, 
                    performing garbage collections, etc.).</li>                    
                    </ol>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="sum" class="style1">Summary</span>
                    <p class="normal">
                    The point of this chapter was to examine exactly how a .NET executable image is hosted by the .NET platform. As you have seen, the long-standing notion of aWin32 process has been altered under the hood to accommodate the needs of the CLR. 
                    A single process (which can be programmatically manipulated via the System.Diagnostics.Process type) is now composed of multiple application domains, which represent isolated and independent boundaries within a process. 
                    As you have seen, a single process can host multiple application domains, each of which is capable of hosting and executing any number of related assemblies.<br />
                    Furthermore, a single application domain can contain any number of contextual boundaries. Using this additional level of type isolation, the CLR can ensure that special-need objects are handled correctly. 
                    The chapter concluded by examining the details regarding how the CLR is hosted by the Win32 OS.
                    </p>
                    </div>
                    </td>
                  </tr>
                </table>
                </td>
              </tr>
            </table>
            </td>
          </tr>
          <tr>
            <td width="100%" style="border-bottom:1px solid #006666; border-left:1px solid #006666; border-right:1px solid #006666; border-top-style: none; border-top-width: medium; " align="center" colspan="5" bgcolor="#006666" height="1">
            <p style="margin-top: 3; margin-bottom: 3"><b>
            <font face="Verdana" size="1" color="#FFFFFF">Copyright 2010
             All Rights Reserved.
             </font></b></p></td>
          </tr>
        </table>
        </td>
      </tr>
    </table>    
      </center>
    </div>    
</body>
</html>