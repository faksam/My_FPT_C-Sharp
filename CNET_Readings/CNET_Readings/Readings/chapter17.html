<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252" />
<title>FPT University - C# & .NET technology</title>
<link rel="stylesheet" href="cf112.css" type="text/css" charset="utf-8" />
</head>
<body>
    <div align="center">
      <center>
    <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-width: 0; bordercolor: #111111" width="1024" id="AutoNumber6">
      <tr>
        <td width="1024" style="border-style: none; border-width: medium; height:168px" height="2" bgcolor="#339966" bordercolor="#333333" background="images/background.jpg"><br /><br />
        <p style="margin-left: 4; margin-top: 0; margin-bottom: 0; text-align:center" ><br/>
        <b><font size="5" color="#FFFFFF" face="Arial Black">Software Development</font></b></p>
        <p style="margin-left: 4; margin-top: 0; margin-bottom: 0"><i>
        <font face="Arial Black" color="#FFCC00">&nbsp;</font></i><br/>
        <br/></p>&nbsp;</td>
      </tr>
      <tr>
        <td width="1024" style="border-style: none; border-width: medium; bordercolor:#333333" bgcolor="#FFFFFF" valign="top">
        <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-left-width: 0; border-right-width: 0; border-bottom-width:0" bordercolor="#006666" width="100%" id="AutoNumber7" height="8">
          <tr>
            <td width="12%" style="border-left: 1px solid #006666; border-right-style: solid; border-right-width: 1; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="index.html">Home</a></td>
            <td width="18%" style="border-left-style: solid; border-left-width: 1; border-right-style: solid; border-right-width: 1; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="outline.html">Outline</a></td>
            <td width="26%" style="border-left-style: solid; border-left-width: 1; border-right-style: solid; border-right-width: 1; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="timeline.html">Timeline</a></td>
            <td width="24%" style="border-left-style: solid; border-left-width: 1; border-right-style: solid; border-right-width: 1; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="readings.html">Readings</a></td>
            <td width="20%" style="border-left-style: solid; border-left-width: 1; border-right: 1px solid #006666; border-top-style: solid; border-top-width: 1; border-bottom-style:none; border-bottom-width:medium" align="center" bgcolor="#006666" bordercolor="#339966" height="15">
            <a class="mainmenu" href="instructors.html">Instructors</a></td>
          </tr>
          <tr>
            <td width="100%" style="border-left-style: none; border-left-width: medium; border-right-style: none; border-right-width: medium; border-top-style: solid; border-top-width: 1; border-bottom-style: none; border-bottom-width: medium" align="center" colspan="5">
            <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-width: 0" bordercolor="#111111" width="100%" id="AutoNumber8">
              <tr>
                <td width="100%" style="border-style: none; border-width: medium">
                <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-left-width: 2; border-right-width: 2; border-top-width: 2; border-bottom-width: 0" bordercolor="#006666" id="AutoNumber9" height="1">
                  <tr>
                    <td width="100%" style="border-style: none; border-width: medium" height="1" colspan="2" bgcolor="#004646">
                    <p style="margin-top: -6; margin-bottom: -6"/></td>
                  </tr>
                  <tr>
                    <td style="border-left-style: none; border-left-width: medium; border-right-style: none; border-right-width: medium; border-top-style: none; border-top-width: medium; border-bottom: 2px none #006666" height="1" bgcolor="#006666" valign="top">
                    <div align="center" style="width: 169">
                      <center>
                      <p style="margin-top: -4; margin-bottom: -4">&nbsp;</p>
                      <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" width="91%" id="AutoNumber10" bgcolor="#FFFFFF" height="1" bordercolor="#003399">
                        <tr>
            <td width="100%" bgcolor="#CAD6EE" style="border-left-color: #003399; border-left-width: 2; border-right-color: #003399; border-right-width: 2; border-top-color:#003399; border-bottom-color:#003399" height="20">
            <p style="margin: 2 3"><b>
            <font face="Verdana" size="2" color="#003399">Readings</font></b></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-bottom-style: none; border-bottom-width: medium; border-top-style:solid; border-top-width:1" height="25">
            <p style="margin: 2 3; "><a class="leftmenu" href="Chapter01.html">Chapter 1</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter02.html">Chapter 2</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter03.html">Chapter 3</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter04.html">Chapter 4</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter05.html">Chapter 5</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium; " height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter06.html">Chapter 6</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter07.html">Chapter 7</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter08.html">Chapter 8</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter10.html">Chapter 10</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter11.html">Chapter 11</a></p></td>
                        </tr>                        
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter13.html">Chapter 13</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter14.html">Chapter 14</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter16.html">Chapter 16</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter17.html">Chapter 17</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter19.html">Chapter 19</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter20.html">Chapter 20</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter21.html">Chapter 21</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter22.html">Chapter 22</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter23.html">Chapter 23</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter24.html">Chapter 24</a></p></td>
                        </tr>
                        <tr>
            <td width="100%" bgcolor="#FFFFFF" style="border-left:1px solid #FF0000; border-right:1px solid #FF0000; border-top-style: none; border-top-width: medium; border-bottom-style:solid; border-bottom-width:1" height="25">
            <p style="margin: 2 3"><a class="leftmenu" href="Chapter25.html">Chapter 25</a></p></td>
                        </tr>
                      </table>
                      </center>
                    </div>
                    </td>                    
                    <td width="855" style="border-left-style: none; border-left-width: medium; border-right-style: solid; border-right-width: 1; border-top-style: none; border-top-width: medium; border-bottom-style: none; border-bottom-width: medium" height="1" valign="top">
                    <div style="margin-left:10px;margin-top:10px;margin-bottom:10px;margin-right:10px">
                    <h1>Chapter 17 - Understanding Object Serialization</h1>
                    <span id="top" class="style1">Content</span>
                    <ul>
                    <li><a href="#ser" class="leftmenu">Understanding Object Serialization</a></li>                    
                    <li><a href="#con" class="leftmenu">Configuring Objects for Serialization</a></li>
                    <li><a href="#for" class="leftmenu">Choosing a Serialization formatter</a></li>
                    <li><a href="#bin" class="leftmenu">Serializing objects using the BinaryFormatter</a></li>
                    <li><a href="#soa" class="leftmenu">Serializing objects using the SoapFormatter</a></li>
                    <li><a href="#xml" class="leftmenu">Serializing objects using the XmlSerializer</a></li>
                    <li><a href="#col" class="leftmenu">Persisting collections of objects</a></li>
                    <li><a href="#sum" class="leftmenu">Summary</a></li>
                    </ul>
                    <p class="normal">
                    This chapter examines the related topic of <i>object serialization</i>. Using object serialization, you are able to persist and retrieve the state of an object to (or from) any System.IO.Stream-derived type.                    
                    </p>
                    <span id="ser" class="style1">Understanding Object Serialization</span>
                    <p class="normal">
                    The term <i>serialization</i> describes the process of persisting (and possibly transferring) the state of an object to a stream. 
                    The persisted data sequence contains all necessary information needed to reconstruct (or <i>deserialize</i>) the state of the object for use later. 
                    Using this technology, it is trivial to save vast amounts of data (in various formats) with minimal fuss and bother. 
                    In fact, in many cases, saving application data using serialization services is much less cumbersome than making direct use of the readers/writers found within the System.IO namespace.                    
                    </p>
                    <span class="style2">The role of Object Graphs</span>
                    <p class="normal">
                    When an object is serialized, the CLR will account for all related objects. The set of related objects is collectively referred to as an <i>object graph</i>. 
                    Object graphs provide a simple way to document how a set of objects refer to each other and do not necessarily map to classic OO relationships (such as the "is-a" or "has-a" relationship), 
                    although they do model this paradigmquite well.<br />
                    Each object in an object graph is assigned a unique numerical value. Keep in mind that the numbers assigned to the members in an object graph are arbitrary and have no real meaning to the outside world. 
                    Once all objects have been assigned a numerical value, the object graph can record each object's set of dependencies.                    
                    </p>
                    <div class="normal" style="float:left;height:240px;width:485px;">
                    As a simple example, assume you have created a set of classes that model some automobiles (of course). You have a base class named Car, which "has-a" Radio. 
                    Another class named JamesBondCar extends the Car base type. The figure shows a possible object graph that models these relationships.<br />
                    Of course, the CLR does not paint pictures in memory to represent a graph of related objects. Rather, the relationship documented in the previous diagram is represented by a more mathematical formula 
                    that looks something like this:<br />
                    <span class="sample">[Car 3, ref 2], [Radio 2], [JamesBondCar 1, ref 3, ref 2]</span>                    
                    </div>                    
                    <div style="float:right;height:240px;width:340px;text-align:center;"><img alt="" src="images/1701.jpg" /></div>
                    <p class="normal">
                    If you parse this formula, you can again see that object 3 (the Car) has a dependency on object 2 (the Radio). 
                    Object 2, the Radio, is a lone wolf and requires nobody. Finally, object 1 (the JamesBondCar) has a dependency on object 3 as well as object 2. 
                    In any case, when you serialize or deserialize an instance of JamesBondCar, the object graph ensures that the Radio and Car types also participate in the process.
                    </p>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="con" class="style1">Configuring Objects for Serialization</span>
                    <p class="normal">
                    Tomake an object available to .NET serialization services, all you need to do is decorate each related class with the [Serializable] attribute. 
                    If you determine that a given class has some member data that should not (or perhaps cannot) participate in the serialization scheme, you can mark such fields with the [NonSerialized] attribute. 
                    This can be helpful if you have member variables in a serializable class that do not need to be "remembered" (e.g., fixed values, random values, transient data, etc.) and you wish to reduce the size of the persisted graph.<br />
                    Here is the Radio class, which has been marked [Serializable], excluding a single member variable (radioID) that has been marked [NonSerialized] and will therefore not be persisted into the specified data stream:<br />
                    <span class="sample">
                    [<b>Serializable</b>]<br />
<span class="keyword">public class</span> Radio<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public bool</span> hasTweeters;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public bool</span> hasSubWoofers;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public double</span>[] stationPresets;<br /><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<b>NonSerialized</b>]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public string</span> radioID = "XF-552RR6";<br />
}
                    </span><br />
                    The JamesBondCar class and Car base class are also marked [Serializable] and define the following pieces of field data:<br />
                    <span class="sample">
                    [<b>Serializable</b>]<br />
<span class="keyword">public class</span> Car<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span> Radio theRadio = new Radio();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public bool</span> isHatchBack;<br />
}<br /><br />
[<b>Serializable</b>]<br />
<span class="keyword">public class</span> JamesBondCar : Car<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public bool</span> canFly;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public bool</span> canSubmerge;<br />
}
                    </span><br />
                    Be aware that the [Serializable] attribute cannot be inherited. Therefore, if you derive a class from a type marked [Serializable], the child class must be marked [Serializable] as well, 
                    or it cannot be persisted. In fact, all objects in an object graph must be marked with the [Serializable] attribute. If you attempt to serialize a nonserializable object using the BinaryFormatter or SoapFormatter, 
                    you will receive a SerializationException at runtime.
                    </p>                    
                    <span class="style2">Public Fields, Private Fields, and Public Properties</span>
                    <p class="normal">
                    You may wonder how the various formatters expect a type's field data to be defined in order to be serialized into a stream. The answer is, it depends. 
                    If you are persisting an object using the BinaryFormatter, it makes absolutely no difference. This type is programmed to serialize <i>all</i> serializable fields of a type, 
                    regardless of whether they are public fields, private fields, or private fields exposed through type properties. 
                    The situation is quite different if you make use of the XmlSerializer or SoapFormatter type, however. These types will <i>only</i> serialize public pieces of field data or private data exposed through public properties.                    
                    </p>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="for" class="style1">Choosing a Serialization formatter</span>
                    <p class="normal">
                    Once you have configured your types to participate in the .NET serialization scheme, your next step is to choose which format should be used when persisting your object graph. 
                    As of .NET 2.0, you have three choices out of the box:
                    </p>
                    <ul>
                    <li>BinaryFormatter</li>
                    <li>SoapFormatter</li>
                    <li>XmlSerializer</li>
                    </ul>
                    <p class="normal">
                    The BinaryFormatter type serializes your object graph to a stream using a compact binary format. This type is defined within the System.Runtime.Serialization.Formatters.Binary namespace that is part of mscorlib.dll. 
                    Therefore, to serialize your objects using a binary format, all you need to do is specify the following C# using directive:<br />
                    <span class="sample">
                    <span class="comment">// Gain access to the BinaryFormatter in mscorlib.dll.</span><br />
                    using System.Runtime.Serialization.Formatters.Binary;
                    </span><br /><br />
                    The SoapFormatter type represents your graph as a SOAP message. This type is defined within the System.Runtime.Serialization.Formatters.Soap namespace that is defined within a separate assembly. 
                    Thus, to format your object graph into a SOAP message, you must set a reference to System.Runtime.Serialization.Formatters.Soap.dll and specify the following C# using directive:<br />
                    <span class="sample">
                    <span class="comment">// Must reference System.Runtime.Serialization.Formatters.Soap.dll!</span><br />
                    using System.Runtime.Serialization.Formatters.Soap;
                    </span><br /><br />
                    Finally, if you wish to persist an object graph as an XML document, you will need to specify that you are using the System.Xml.Serialization namespace, which is also defined in a separate assembly: System.Xml.dll. 
                    As luck would have it, all Visual Studio 2005 project templates automatically reference System.Xml.dll, therefore you will simply need to use the following namespace:<br />
                    <span class="sample">
                    <span class="comment">// Defined within System.Xml.dll.</span><br />
                    using System.Xml.Serialization;
                    </span>
                    </p>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="bin" class="style1">Serializing objects using the BinaryFormatter</span>
                    <p class="normal">
                     The two key methods of the BinaryFormatter type to be aware of are Serialize() and Deserialize():
                    </p>
                    <ul>
                    <li>Serialize(): Persists an object graph to a specified stream as a sequence of bytes</li>
                    <li>Deserialize(): Converts a persisted sequence of bytes to an object graph</li>
                    </ul>
                    <p class="normal">Here is example of serializing an object of the JamesBondCar class.</p>
                    <p class="sample">
<span class="keyword">using</span> System.Runtime.Serialization.Formatters.Binary;<br />
<span class="keyword">using</span> System.IO;<br /><br />
<span class="keyword">static void</span> Main(<span class="keyword">string</span>[] args)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("***** Fun with Object Serialization *****\n");<br /><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Make a JamesBondCar and set state.</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JamesBondCar jbc = new JamesBondCar();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jbc.canFly = <span class="keyword">true</span>;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jbc.canSubmerge = <span class="keyword">false</span>;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jbc.theRadio.stationPresets = new <span class="keyword">double</span>[]{89.3, 105.1, 97.1};<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jbc.theRadio.hasTweeters = <span class="keyword">true</span>;<br /><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Save object to a file named CarData.dat in binary.</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BinaryFormatter binFormat = new BinaryFormatter();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stream fStream = new FileStream("CarData.dat", FileMode.Create, FileAccess.Write, FileShare.None);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binFormat.Serialize(fStream, jbc);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fStream.Close();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadLine();<br />
}
                    </p>
                    <span class="style2">Deserializing Objects Using the BinaryFormatter</span>
                    <p class="normal">
                    Now suppose you want to read the persisted JamesBondCar from the binary file back into an object variable. Once you have programmatically opened CarData.dat 
                    (via the File.OpenRead()method), simply call the Deserialize()method of the BinaryFormatter. Be aware that Deserialize() returns a generic System.Object type, 
                    so you need to impose an explicit cast, as shown here:
                    </p>
                    <p class="sample">
<span class="keyword">static void</span> Main(<span class="keyword">string</span>[] args)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Read the JamesBondCar from the binary file.</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fStream = File.OpenRead("CarData.dat");<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JamesBondCar carFromDisk = (JamesBondCar)binFormat.Deserialize(fStream);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("Can this car fly? : {0}", carFromDisk.canFly);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fStream.Close();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadLine();<br />
}                    
                    </p>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="soa" class="style1">Serializing objects using the SoapFormatter</span>
                    <p class="normal">
                    The SoapFormatter will persist an object graph into a SOAP message, which makes this formatter a solid choice when you wish to distribute objects remotely using the HTTP protocol. 
                    If you are unfamiliar with the SOAP specification, don't sweat the details right now. In a nutshell, SOAP defines a standard process in which methods may be invoked in a platform- and OS-neutral manner.<br />
                    Consider the following code, which serializes an object of JamesBondCar class to a local file named CarData.soap.
                    </p>
                    <p class="sample">
<span class="keyword">using</span> System.Runtime.Serialization.Formatters.Soap;<br /><br />
<span class="keyword">static void</span> Main(<span class="keyword">string</span>[] args)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Save object to a file named CarData.soap in SOAP format.</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SoapFormatter soapFormat = new SoapFormatter();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fStream = new FileStream("CarData.soap", FileMode.Create, FileAccess.Write, FileShare.None);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;soapFormat.Serialize(fStream, jbc);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fStream.Close();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadLine();<br />
}                    
                    </p>
                    <p class="normal">
                    As before, simply use Serialize() and Deserialize() to move the object graph in and out of the stream. 
                    If you open the resulting *.soap file, you can locate the XML elements that mark the stateful values of the current JamesBondCar as well as the relationship between the objects in the graph via the #ref tokens.
                    </p>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="xml" class="style1">Serializing objects using the XmlSerializer</span>
                    <p class="normal">
                    In addition to the SOAP and binary formatters, the System.Xml.dll assembly provides a third formatter, System.Xml.Serialization.XmlSerializer, which can be used to persist the state of a given object as pure XML, 
                    as opposed to XML data wrapped within a SOAP message. Working with this type is a bit different from working with the SoapFormatter or BinaryFormatter type. Consider the following code:
                    </p>
                    <p class="sample">
<span class="keyword">using</span> System.Xml.Serialization;<br /><br />
<span class="keyword">static void</span> Main(<span class="keyword">string</span>[] args)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Save object to a file named CarData.xml in XML format.</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlSerializer xmlFormat = new XmlSerializer(<span class="keyword">typeof</span>(JamesBondCar), <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new <span class="keyword">Type</span>[] { <span class="keyword">typeof</span>(Radio), <span class="keyword">typeof</span>(Car) });<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fStream = new FileStream("CarData.xml", FileMode.Create, FileAccess.Write, FileShare.None);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlFormat.Serialize(fStream, jbc);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fStream.Close();<br />
}                    
                    </p>
                    <p class="normal">
                    The key difference is that the XmlSerializer type requires you to specify type information that represents the items in the object graph. Notice that the first constructor argument of the XmlSerializer defines the root element of the XML file, 
                    while the second argument is an array of System.Type types that hold metadata regarding the subelements.
                    </p>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="col" class="style1">Persisting collections of objects</span>
                    <p class="normal">
                    Now that you have seen how to persist a single object to a stream, let's examine how to save a set of objects. 
                    As you may have noticed, the Serialize()method of the IFormatter interface does not provide a way to specify an arbitrary number of objects (only a single System.Object).<br />
                    Recall that the System.Object in fact represents a complete object graph. Given this, if you pass in an object that has been marked as [Serializable] and contains other [Serializable] objects, 
                    the entire set of objects is persisted right away. As luck would have it, most of the types found within the System.Collections and System.Collections.Generic namespaces have already been marked as [Serializable]. 
                    Therefore, if you wish to persist a set of objects, simply add the set to the container (such as an ArrayList or List&lt;&gt;) and serialize the object to your stream of choice.<br />
                    Assume you have updated the JamesBondCar class with a two-argument constructor to set a few pieces of state data (note that you add back the default constructor as required by the XmlSerializer):
                    </p>
                    <p class="sample">
[Serializable, XmlRoot(Namespace = "http://www.intertechtraining.com")]<br />
<span class="keyword">public class</span> JamesBondCar : Car<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span> JamesBondCar (<span class="keyword">bool</span> skyWorthy, <span class="keyword">bool</span> seaWorthy)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;canFly = skyWorthy;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;canSubmerge = seaWorthy;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// The XmlSerializer demands a default constructor!</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span> JamesBondCar(){}<br />
}<br /><br />
<span class="keyword">static void</span> Main(<span class="keyword">string</span>[] args)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Now persist a List<> of JamesBondCars.</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;JamesBondCar&gt; myCars = new List&lt;JamesBondCar&gt;();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCars.Add(<span class="keyword">new</span> JamesBondCar(<span class="keyword">true</span>, <span class="keyword">true</span>));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCars.Add(<span class="keyword">new</span> JamesBondCar(<span class="keyword">true</span>, <span class="keyword">false</span>));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCars.Add(<span class="keyword">new</span> JamesBondCar(<span class="keyword">false</span>, <span class="keyword">true</span>));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCars.Add(<span class="keyword">new</span> JamesBondCar(<span class="keyword">false</span>, <span class="keyword">false</span>));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fStream = <span class="keyword">new</span> FileStream("CarCollection.xml", FileMode.Create, FileAccess.Write, FileShare.None);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlFormat = new XmlSerializer(<span class="keyword">typeof</span>(List&lt;JamesBondCar&gt;),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Type[] { <span class="keyword">typeof</span>(JamesBondCar), <span class="keyword">typeof</span>(Car), <span class="keyword">typeof</span>(Radio) });<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlFormat.Serialize(fStream, myCars);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fStream.Close();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadLine();<br />
}
                    </p>
                    <div style="width:100%;text-align:right;"><a class="leftmenu" href="#top">Back to top</a></div>
                    <span id="sum" class="style1">Summary</span>
                    <p class="normal">
                    This chapter introduced the topic of object serialization services. As you have seen, the .NET platform makes use of an object graph to correctly account for the full set of related objects 
                    that are to be persisted to a stream. As long as each member in the object graph has been marked with the [Serializable] attribute, the data is persisted using your format of choice (binary, SOAP, or XML).                    
                    </p>
                    </div>
                    </td>
                  </tr>
                </table>
                </td>
              </tr>
            </table>
            </td>
          </tr>
          <tr>
            <td width="100%" style="border-bottom:1px solid #006666; border-left:1px solid #006666; border-right:1px solid #006666; border-top-style: none; border-top-width: medium; " align="center" colspan="5" bgcolor="#006666" height="1">
            <p style="margin-top: 3; margin-bottom: 3"><b>
            <font face="Verdana" size="1" color="#FFFFFF">Copyright 2010
             All Rights Reserved.
             </font></b></p></td>
          </tr>
        </table>
        </td>
      </tr>
    </table>    
      </center>
    </div>    
</body>
</html>